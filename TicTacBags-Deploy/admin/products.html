<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Products Management - TicTacBags Admin</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
</head>
<body class="bg-light">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="admin-sidebar">
                    <!-- Admin Brand -->
                    <div class="text-center mb-4">
                        <h4 class="text-white fw-bold">
                            <i class="fas fa-shopping-bag me-2"></i>TicTacBags
                        </h4>
                        <p class="text-white-50 small mb-0">Admin Panel</p>
                    </div>

                    <!-- Admin User Info -->
                    <div class="text-center mb-4 pb-3 border-bottom border-secondary">
                        <div class="bg-white bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <h6 class="text-white mb-1">Administrator</h6>
                        <small class="text-white-50" id="loginTime"></small>
                    </div>

                    <!-- Navigation Menu -->
                    <ul class="admin-nav">
                        <li>
                            <a href="dashboard.html">
                                <i class="fas fa-tachometer-alt"></i>
                                Orders Management
                            </a>
                        </li>
                        <li>
                            <a href="products.html" class="active">
                                <i class="fas fa-box"></i>
                                Products Management
                            </a>
                        </li>
                        <li>
                            <a href="categories.html">
                                <i class="fas fa-list"></i>
                                Categories Management
                            </a>
                        </li>
                        <li>
                            <a href="brands.html">
                                <i class="fas fa-tags"></i>
                                Brands Management
                            </a>
                        </li>
                        <li>
                            <a href="banners.html">
                                <i class="fas fa-images"></i>
                                Banner Management
                            </a>
                        </li>
                        <li>
                            <a href="../index.html" target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                View Website
                            </a>
                        </li>
                        <li class="mt-4">
                            <a href="#" onclick="logout()" class="text-danger">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <div class="admin-content">
                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1 class="fw-bold text-dark">Products Management</h1>
                            <p class="text-muted">Add, edit, and manage your product catalog</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-success" onclick="showAddProductModal()">
                                <i class="fas fa-plus me-2"></i>Add Product
                            </button>
                            <button class="btn btn-outline-primary" onclick="refreshProducts()">
                                <i class="fas fa-sync-alt me-2"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Product Statistics -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="admin-card">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
                                        <i class="fas fa-box text-primary" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h3 class="fw-bold mb-1" id="totalProducts">0</h3>
                                        <p class="text-muted mb-0 small">Total Products</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="admin-card">
                                <div class="d-flex align-items-center">
                                    <div class="bg-success bg-opacity-10 rounded p-3 me-3">
                                        <i class="fas fa-check-circle text-success" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h3 class="fw-bold mb-1" id="activeProducts">0</h3>
                                        <p class="text-muted mb-0 small">Active Products</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="admin-card">
                                <div class="d-flex align-items-center">
                                    <div class="bg-warning bg-opacity-10 rounded p-3 me-3">
                                        <i class="fas fa-star text-warning" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h3 class="fw-bold mb-1" id="featuredProducts">0</h3>
                                        <p class="text-muted mb-0 small">Featured Products</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="admin-card">
                                <div class="d-flex align-items-center">
                                    <div class="bg-info bg-opacity-10 rounded p-3 me-3">
                                        <i class="fas fa-tags text-info" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h3 class="fw-bold mb-1" id="totalCategories">0</h3>
                                        <p class="text-muted mb-0 small">Categories</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products Filter -->
                    <div class="admin-card mb-4">
                        <div class="d-flex flex-wrap gap-3 align-items-center">
                            <div>
                                <label class="form-label small mb-1">Filter by Status:</label>
                                <select class="form-select form-select-sm" id="statusFilter" onchange="filterProducts()">
                                    <option value="">All Products</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label small mb-1">Filter by Category:</label>
                                <select class="form-select form-select-sm" id="categoryFilter" onchange="filterProducts()">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label small mb-1">Search Products:</label>
                                <input type="text" class="form-control form-control-sm" id="searchProducts" placeholder="Product name, ID..." onkeyup="searchProducts()">
                            </div>
                            <div class="align-self-end">
                                <button class="btn btn-outline-secondary btn-sm" onclick="clearFilters()">
                                    <i class="fas fa-times me-1"></i>Clear
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div id="productsGrid" class="row">
                        <!-- Products will be loaded here -->
                    </div>

                    <!-- No Products Message -->
                    <div id="noProductsMessage" class="admin-card text-center py-5 d-none">
                        <i class="fas fa-box text-muted mb-3" style="font-size: 3rem;"></i>
                        <h5 class="text-muted">No products found</h5>
                        <p class="text-muted">Start by adding your first product to the catalog.</p>
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus me-2"></i>Add Product
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalTitle">Add Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="productForm">
                    <div class="modal-body">
                        <input type="hidden" id="productId" name="productId">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="productTitle" class="form-label">Product Title *</label>
                                <input type="text" class="form-control" id="productTitle" name="title" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productBrand" class="form-label">Brand *</label>
                                <input type="text" class="form-control" id="productBrand" name="brand" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="productCategory" class="form-label">Category *</label>
                                <select class="form-select" id="productCategory" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Backpacks">Backpacks</option>
                                    <option value="Handbags">Handbags</option>
                                    <option value="Travel Bags">Travel Bags</option>
                                    <option value="Laptop Bags">Laptop Bags</option>
                                    <option value="Tote Bags">Tote Bags</option>
                                    <option value="Sports Bags">Sports Bags</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productPrice" class="form-label">Price (Rs) *</label>
                                <input type="number" class="form-control" id="productPrice" name="price" step="0.01" min="0" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Description *</label>
                            <textarea class="form-control" id="productDescription" name="description" rows="4" required></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="productImage" class="form-label">Image URL *</label>
                            <input type="url" class="form-control" id="productImage" name="image" required placeholder="https://example.com/image.jpg">
                            <small class="text-muted">Enter a valid image URL</small>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="productActive" name="active" checked>
                                    <label class="form-check-label" for="productActive">Active</label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="productFeatured" name="featured">
                                    <label class="form-check-label" for="productFeatured">Featured</label>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="productLatest" name="latest">
                                    <label class="form-check-label" for="productLatest">Latest</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Save Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let products = [];
        let filteredProducts = [];

        // Check admin authentication
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
            loadProducts();
            updateLoginTime();
        });

        function checkAdminAuth() {
            const loginData = localStorage.getItem('tictacbags_admin_login');
            if (!loginData) {
                window.location.href = 'index.html';
                return;
            }

            const data = JSON.parse(loginData);
            const now = new Date().getTime();
            const sessionDuration = data.rememberMe ? (24 * 60 * 60 * 1000) : (60 * 60 * 1000);
            
            if ((now - data.timestamp) > sessionDuration) {
                localStorage.removeItem('tictacbags_admin_login');
                window.location.href = 'index.html';
                return;
            }
        }

        function updateLoginTime() {
            const loginData = localStorage.getItem('tictacbags_admin_login');
            if (loginData) {
                const data = JSON.parse(loginData);
                const loginDate = new Date(data.timestamp);
                document.getElementById('loginTime').textContent = loginDate.toLocaleString();
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('tictacbags_admin_login');
                window.location.href = 'index.html';
            }
        }

        function loadProducts() {
            // Load products from localStorage
            products = JSON.parse(localStorage.getItem('tictacbags_products')) || [];
            filteredProducts = [...products];
            
            updateProductStats();
            populateCategoryFilter();
            displayProducts();
        }

        function updateProductStats() {
            const totalProducts = products.length;
            const activeProducts = products.filter(p => p.active).length;
            const featuredProducts = products.filter(p => p.featured).length;
            const categories = [...new Set(products.map(p => p.category))].length;

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('activeProducts').textContent = activeProducts;
            document.getElementById('featuredProducts').textContent = featuredProducts;
            document.getElementById('totalCategories').textContent = categories;
        }

        function populateCategoryFilter() {
            const categories = [...new Set(products.map(p => p.category))];
            const categoryFilter = document.getElementById('categoryFilter');
            
            // Clear existing options except "All Categories"
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        function displayProducts() {
            const grid = document.getElementById('productsGrid');
            const noProductsMsg = document.getElementById('noProductsMessage');
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = '';
                noProductsMsg.classList.remove('d-none');
                return;
            }

            noProductsMsg.classList.add('d-none');
            grid.innerHTML = '';

            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                grid.appendChild(productCard);
            });
        }

        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-lg-4 col-md-6 mb-4';
            
            const statusBadge = product.active ? 
                '<span class="badge bg-success position-absolute top-0 start-0 m-2">Active</span>' :
                '<span class="badge bg-secondary position-absolute top-0 start-0 m-2">Inactive</span>';

            const featuredBadge = product.featured ? 
                '<span class="badge bg-warning position-absolute top-0 end-0 m-2">Featured</span>' : '';

            col.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="position-relative">
                        <img src="${product.image}" class="card-img-top" alt="${product.title}" style="height: 200px; object-fit: cover;">
                        ${statusBadge}
                        ${featuredBadge}
                    </div>
                    <div class="card-body">
                        <h6 class="card-title fw-bold">${product.title}</h6>
                        <p class="text-muted small mb-2">${product.brand} | ${product.category}</p>
                        <p class="card-text small text-muted">${product.description.substring(0, 80)}...</p>
                        <p class="text-primary fw-bold mb-3">Rs ${product.price.toLocaleString()}</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <div class="btn-group w-100">
                            <button class="btn btn-outline-primary btn-sm" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-outline-${product.active ? 'warning' : 'success'} btn-sm" onclick="toggleProductStatus(${product.id})">
                                <i class="fas fa-${product.active ? 'pause' : 'play'}"></i> ${product.active ? 'Block' : 'Activate'}
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return col;
        }

        function showAddProductModal() {
            document.getElementById('productModalTitle').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productActive').checked = true;
            
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('productModalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = product.id;
            document.getElementById('productTitle').value = product.title;
            document.getElementById('productBrand').value = product.brand;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productImage').value = product.image;
            document.getElementById('productActive').checked = product.active;
            document.getElementById('productFeatured').checked = product.featured;
            document.getElementById('productLatest').checked = product.latest;

            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        function toggleProductStatus(productId) {
            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                products[productIndex].active = !products[productIndex].active;
                localStorage.setItem('tictacbags_products', JSON.stringify(products));
                loadProducts();
                
                const status = products[productIndex].active ? 'activated' : 'blocked';
                showNotification(`Product ${status} successfully!`, 'success');
            }
        }

        function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                return;
            }

            products = products.filter(p => p.id !== productId);
            localStorage.setItem('tictacbags_products', JSON.stringify(products));
            loadProducts();
            showNotification('Product deleted successfully!', 'success');
        }

        // Handle product form submission
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const productId = formData.get('productId');

            const productData = {
                id: productId ? parseInt(productId) : Date.now(),
                title: formData.get('title'),
                brand: formData.get('brand'),
                category: formData.get('category'),
                price: parseFloat(formData.get('price')),
                description: formData.get('description'),
                image: formData.get('image'),
                active: formData.has('active'),
                featured: formData.has('featured'),
                latest: formData.has('latest')
            };

            if (productId) {
                // Edit existing product
                const productIndex = products.findIndex(p => p.id === parseInt(productId));
                if (productIndex !== -1) {
                    products[productIndex] = { ...products[productIndex], ...productData };
                    showNotification('Product updated successfully!', 'success');
                }
            } else {
                // Add new product
                products.push(productData);
                showNotification('Product added successfully!', 'success');
            }

            localStorage.setItem('tictacbags_products', JSON.stringify(products));
            bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
            loadProducts();
        });

        function filterProducts() {
            const statusFilter = document.getElementById('statusFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredProducts = products.filter(product => {
                let matchesStatus = true;
                if (statusFilter === 'active') matchesStatus = product.active;
                if (statusFilter === 'inactive') matchesStatus = !product.active;
                
                let matchesCategory = !categoryFilter || product.category === categoryFilter;
                
                return matchesStatus && matchesCategory;
            });
            
            displayProducts();
        }

        function searchProducts() {
            const searchTerm = document.getElementById('searchProducts').value.toLowerCase();
            
            if (!searchTerm) {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(product => 
                    product.title.toLowerCase().includes(searchTerm) ||
                    product.brand.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm) ||
                    product.id.toString().includes(searchTerm)
                );
            }
            
            displayProducts();
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('searchProducts').value = '';
            filteredProducts = [...products];
            displayProducts();
        }

        function refreshProducts() {
            loadProducts();
            showNotification('Products refreshed successfully!', 'info');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
</body>
</html>